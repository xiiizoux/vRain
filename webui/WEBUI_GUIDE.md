# vRain WebUI 使用指南

## 概述

vRain WebUI 是为 vRain 中文古籍刻本风格电子书制作工具开发的现代化Web界面。它提供了直观的图形界面来管理书籍项目、配置参数、生成电子书等功能。

## 主要功能

### 📚 书籍管理
- **项目创建**: 创建新的书籍项目，设置基本信息
- **文本管理**: 上传、编辑、删除文本文件
- **配置编辑**: 可视化编辑书籍排版配置
- **状态跟踪**: 实时查看项目状态和进度

### 🎨 背景图管理
- **背景图库**: 管理多种风格的背景图模板
- **参数配置**: 调整尺寸、边距、线条等参数
- **风格支持**: 普通、宣纸做旧、竹简等多种风格
- **实时预览**: 配置修改后即时预览效果

### ⚙️ 生成控制
- **批量生成**: 支持指定页面范围的批量生成
- **实时监控**: 查看生成进度和日志输出
- **任务管理**: 管理正在运行的生成任务
- **结果下载**: 直接下载生成的PDF文件

### 🔧 工具集成
- **字体检查**: 检查文本字符的字体支持情况
- **文本格式化**: 自动格式化和缩进文本
- **图片插入**: 批量插入图片到文本中
- **PDF压缩**: 压缩生成的PDF文件

## 快速开始

### 方式一：Docker 部署（推荐）

```bash
# 1. 启动vRain集成服务（包括WebUI）
docker-compose up -d vrain

# 或使用便捷命令
make up

# 2. 访问WebUI
open http://localhost:3012
```

### 方式二：开发模式

```bash
# 1. 进入webui目录
cd webui

# 2. 启动开发环境
./start.sh dev

# 3. 访问WebUI（开发环境）
open http://localhost:3000
```

## 界面导航

### 主导航菜单

1. **书籍管理** (`/books`)
   - 查看所有书籍项目
   - 创建、编辑、删除书籍
   - 管理文本文件

2. **背景图管理** (`/canvas`)
   - 管理背景图模板
   - 配置背景图参数
   - 生成背景图

3. **生成管理** (`/generate`)
   - 查看生成任务
   - 监控生成进度
   - 下载生成结果

4. **工具集** (`/tools`)
   - 字体检查工具
   - 文本处理工具
   - 其他辅助工具

5. **日志查看** (`/logs`)
   - 查看系统日志
   - 查看任务日志
   - 错误诊断

6. **系统设置** (`/settings`)
   - 系统配置
   - 用户设置
   - 环境信息

## 使用流程

### 创建第一个书籍项目

1. **创建项目**
   - 点击"新建书籍"按钮
   - 填写书名、作者等基本信息
   - 选择背景图模板
   - 点击"创建"

2. **上传文本**
   - 进入书籍详情页
   - 点击"文本管理"标签
   - 上传.txt格式的文本文件
   - 文件名建议使用001.txt、002.txt等格式

3. **配置参数**
   - 点击"配置编辑"标签
   - 调整字体、大小、颜色等参数
   - 设置页面布局和样式
   - 保存配置

4. **生成电子书**
   - 点击"生成"按钮
   - 选择生成范围（起始页-结束页）
   - 选择是否压缩PDF
   - 开始生成

5. **查看结果**
   - 在"生成管理"中查看进度
   - 生成完成后下载PDF文件
   - 查看生成日志

### 背景图管理

1. **查看现有背景图**
   - 进入"背景图管理"页面
   - 浏览可用的背景图模板

2. **创建新背景图**
   - 点击"新建背景图"
   - 设置基本信息和风格
   - 配置尺寸、边距等参数
   - 生成背景图

3. **编辑背景图**
   - 选择要编辑的背景图
   - 修改配置参数
   - 重新生成

## 配置说明

### 书籍配置参数

#### 基本设置
- **title**: 书籍标题
- **author**: 作者信息
- **canvas_id**: 背景图ID
- **row_num**: 每列字数
- **row_delta_y**: 列底部边距

#### 字体设置
- **font1-4**: 主字体和备用字体
- **try_st**: 是否尝试繁简转换
- **text_font_size**: 正文字体大小
- **comment_font_size**: 批注字体大小

#### 版面设置
- **cover_***: 封面相关设置
- **title_***: 版心标题设置
- **pager_***: 页码设置

#### 标点处理
- **exp_replace_comma**: 标点符号替换规则
- **if_nocomma**: 无标点模式
- **if_onlyperiod**: 标点归一化

### 背景图配置参数

#### 画布设置
- **canvas_width/height**: 画布尺寸
- **canvas_color**: 背景颜色
- **margin_***: 各方向边距

#### 版面设置
- **leaf_col**: 列数
- **leaf_col_width**: 列宽

#### 线条设置
- **inline_***: 内框线设置
- **outline_***: 外框线设置

#### 装饰设置
- **fishtop_***: 上鱼尾设置
- **fishbtm_***: 下鱼尾设置
- **logo_***: 书房名设置

## 故障排除

### 常见问题

1. **无法访问WebUI**
   - 检查Docker服务是否启动
   - 确认端口3000和3001未被占用
   - 查看容器日志：`docker-compose logs webui-frontend webui-backend`

2. **生成失败**
   - 检查文本文件格式是否正确
   - 确认字体文件是否存在
   - 查看任务日志获取详细错误信息

3. **文件上传失败**
   - 确认文件大小不超过10MB
   - 检查文件格式是否为.txt
   - 确认磁盘空间充足

4. **配置保存失败**
   - 检查配置参数是否在有效范围内
   - 确认有写入权限
   - 查看后端日志

### 日志查看

1. **WebUI日志**
   ```bash
   # 查看前端日志
   docker-compose logs webui-frontend
   
   # 查看后端日志
   docker-compose logs webui-backend
   ```

2. **vRain日志**
   ```bash
   # 查看vRain执行日志
   docker-compose logs vrain
   ```

3. **系统日志**
   - 在WebUI的"日志查看"页面查看
   - 日志文件位置：`logs/webui/`

## 开发指南

### 本地开发

1. **环境要求**
   - Node.js 18+
   - npm 或 yarn
   - Docker（可选）

2. **启动开发环境**
   ```bash
   cd webui
   ./start.sh dev
   ```

3. **项目结构**
   ```
   webui/
   ├── frontend/          # Vue.js前端
   ├── backend/           # Express.js后端
   ├── shared/            # 共享代码
   └── docs/              # 文档
   ```

### API文档

WebUI后端提供RESTful API，详细文档请参考：
- API基础地址：`http://localhost:3012/api`
- 健康检查：`GET /api/health`
- 书籍管理：`/api/books`
- 背景图管理：`/api/canvas`
- 任务管理：`/api/tasks`

## 更新日志

### v1.0.0 (2025-01)
- 初始版本发布
- 基础书籍管理功能
- 背景图管理功能
- 生成任务监控
- Docker部署支持

## 技术支持

如有问题或建议，请：
1. 查看本文档的故障排除部分
2. 检查项目的GitHub Issues
3. 联系开发团队

---

**vRain WebUI** - 让古籍电子书制作更简单、更现代化！
