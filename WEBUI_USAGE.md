# vRain WebUI 使用指南

## 概述

vRain WebUI 是一个现代化的Web界面，用于管理和生成中文古籍电子书。它提供了完整的书籍管理、配置编辑、文件管理和生成监控功能。

## 快速开始

### 使用Docker（推荐）

1. **启动服务**
   ```bash
   # 启动所有服务
   docker-compose up -d
   
   # 查看服务状态
   docker-compose ps
   
   # 查看日志
   docker-compose logs -f vrain
   ```

2. **访问WebUI**
   - 打开浏览器访问：http://localhost:3012
   - WebUI将自动加载现有的书籍项目

3. **停止服务**
   ```bash
   docker-compose down
   ```

### 使用Makefile（推荐）

```bash
# 启动服务
make up

# 查看状态
make status

# 生成书籍（示例）
make run BOOK=01 FROM=1 TO=2 COMPRESS=1

# 测试模式
make test BOOK=01

# 查看日志
make logs

# 停止服务
make down
```

## 主要功能

### 1. 书籍管理

- **书籍列表**：查看所有书籍项目，支持搜索和筛选
- **书籍详情**：查看书籍基本信息、文本文件和生成的PDF
- **创建书籍**：创建新的书籍项目
- **编辑书籍**：修改书籍基本信息

### 2. 配置管理

- **基本配置**：书名、作者、背景图模板、每列字数等
- **字体配置**：主字体、备用字体、繁简转换设置
- **正文字体**：正文字体大小和颜色设置
- **批注字体**：批注字体大小和颜色设置
- **封面配置**：封面标题和作者的字体大小、位置
- **版心配置**：版心标题的位置、后缀、PDF目录生成

### 3. 文件管理

- **文本文件**：上传、编辑、查看、下载文本文件
- **生成文件**：查看、下载、预览生成的PDF文件
- **文件编辑器**：内置文本编辑器，支持直接编辑文本内容

### 4. 生成功能

- **完整生成**：生成完整的电子书PDF
- **预览生成**：生成前几页用于预览和调试
- **自定义范围**：指定生成的页面范围
- **压缩选项**：自动压缩生成的PDF文件
- **实时监控**：查看生成进度和日志

### 5. 任务管理

- **任务列表**：查看所有生成任务的状态
- **实时更新**：自动刷新任务状态和进度
- **任务控制**：取消正在运行的任务
- **日志查看**：查看详细的任务执行日志

## 使用流程

### 创建新书籍

1. 点击"新建书籍"按钮
2. 填写书籍基本信息（书名、作者、描述）
3. 系统自动生成书籍ID或手动指定
4. 点击"创建"完成书籍创建

### 配置书籍参数

1. 进入书籍详情页面
2. 点击"配置参数"按钮
3. 根据需要调整各项配置参数
4. 点击"保存配置"

### 管理文本文件

1. 进入书籍详情页面
2. 点击"文件管理"按钮
3. 上传文本文件或编辑现有文件
4. 文件名建议使用数字编号（如001.txt, 002.txt）

### 生成电子书

1. 在书籍列表或详情页面点击"生成"按钮
2. 选择生成类型（完整生成或预览生成）
3. 配置生成选项（页面范围、压缩等）
4. 点击"开始生成"
5. 在"生成管理"页面监控进度

### 查看生成结果

1. 生成完成后，在书籍详情页面的"生成的文件"部分查看
2. 点击"下载"按钮下载PDF文件
3. 点击"预览"按钮在浏览器中查看PDF

## 现有书籍

WebUI会自动识别和加载以下现有书籍：

- **01 - 诗经集传**：宋朱熹著
- **05 - 碧血劍**：金庸著  
- **21 - 史記**：漢司馬遷著
- **30 - 戰國策校注**：【宋】鲍彪原注【元】吴师道补注
- **31 - 莊子**：莊子
- **32 - 莊子**：莊子（带图片版本）

这些书籍已包含配置文件和文本文件，可以直接进行生成操作。

## 故障排除

### 常见问题

1. **无法访问WebUI**
   - 检查Docker服务是否正常运行
   - 确认端口3012没有被占用
   - 查看容器日志：`docker-compose logs vrain`

2. **书籍列表为空**
   - 确认books目录已正确挂载
   - 检查书籍目录是否包含book.cfg文件
   - 查看后端日志确认是否有错误

3. **生成任务失败**
   - 检查文本文件是否存在且格式正确
   - 确认字体文件是否可用
   - 查看任务日志获取详细错误信息

4. **文件上传失败**
   - 确认文件格式为.txt
   - 检查文件大小是否超过10MB限制
   - 确认books目录有写入权限

### 日志查看

```bash
# 查看所有服务日志
docker-compose logs -f

# 查看特定服务日志
docker-compose logs -f vrain

# 查看WebUI后端日志
docker-compose exec vrain tail -f /app/logs/webui/app.log
```

## 技术架构

- **前端**：Vue 3 + Element Plus + Vite
- **后端**：Node.js + Express
- **反向代理**：Nginx
- **核心引擎**：Perl脚本（vrain.pl）
- **容器化**：Docker + Docker Compose

## 开发说明

如需修改WebUI代码：

1. 前端代码位于：`webui/frontend/src/`
2. 后端代码位于：`webui/backend/src/`
3. 修改后重新构建：`docker-compose build vrain`
4. 重启服务：`docker-compose restart vrain`

## 支持

如遇到问题，请查看：
1. 项目README.md文件
2. Docker日志输出
3. WebUI内的任务日志
4. 浏览器开发者工具的控制台输出
